<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wallkit Integration Demo</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oxygen:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
       .wrap-pro-sign-up {
           font-family: Oxygen, sans-serif;
           text-align: center;
           color: #161616;
       }

       .wrap-pro-sign-up__steps {
           display: flex;
           align-items: center;
           justify-content: space-around;
       }

       .wrap-pro-sign-up__title {
           font-weight: 700;
           font-size: 24px;
           line-height: 30px;
       }

       .wrap-pro-sign-up__small-title {
           font-size: 18px;
           line-height: 25px;
           margin-bottom: 20px;
       }

       ul {
           padding-left: 0;
           list-style: none;
       }

       .wrap-pro-sign-up__step {
           font-weight: 400;
           font-size: 16px;
           line-height: 26px;
           margin: 0 10px;
           color: #828282;
       }

       .wrap-pro-sign-up__step--active {
           border-bottom: 2px solid #10D765;
           color: #161616;
       }

       .wrap-pro-sign-up__btn {
           background: #161616;
           border-radius: 5px;
           width: 100%;
           padding: 10px 34px;
           text-align: center;
           border: none;
           color: #fff;
           text-transform: uppercase;
           margin: 20px 0;
           display: block;
       }

       .wrap-pro-sign-up__terms {
           font-size: 14px;
           text-align: left;
       }

       .green-text {
           color: #10D765;
           text-decoration: none;
       }

       .wrap-pro-sign-up .firebaseui-container {
           box-shadow: none;
       }

       .wrap-pro-sign-up .firebaseui-card-header {
           padding-left: 0;
       }

       .wrap-pro-sign-up .firebaseui-card-content {
           padding: 0;
       }

       .wrap-pro-sign-up .firebaseui-container,
       .wrap-pro-sign-up .firebaseui-idp-button {
           max-width: 100%;
           width: 100%;
       }

       .wrap-pro-sign-up .firebaseui-idp-button {
           box-shadow: none;
           border-radius: 0;
           border: 1px solid #BDBDBD;
           background: #FFFFFF;
       }

       .wrap-pro-sign-up .mdl-button--raised.mdl-button--colored,
       .wrap-pro-sign-up .firebaseui-textfield.mdl-textfield .firebaseui-label::after {
           background-color: #000;
       }

       .wrap-pro-sign-up .mdl-button--raised.mdl-button--colored:hover,
       .wrap-pro-sign-up .mdl-button--raised.mdl-button--colored:focus,
       .wrap-pro-sign-up .mdl-button--raised.mdl-button--colored:active {
           background-color: #303030;
       }

       .wrap-pro-sign-up .mdl-button--primary.mdl-button--primary {
           color: #000;
       }

       .wrap-pro-sign-up .firebaseui-list-item:first-child .firebaseui-idp-button {
           border: none;
       }

    </style>
    <script>window.config = {"api_url":"https:\/\/api.dev.wallkit.net\/api\/v1"};</script>
</head>
<body>
    <button onclick="WallkitInt.authentication.show()">
        Login


    <button onclick="openClassicLogin()">
        Classic
    </button>

    <button onclick="openJourneyLogin()">
        Journey
    </button>

<!--    <div class="wk-auth-form">-->
<!--        <div class="wk-form-field wk-form-field&#45;&#45;valid">-->
<!--            <label for="email" class="wk-form-field__label">Email</label>-->
<!--            <input type="email"-->
<!--                   id="email"-->
<!--                   name="email"-->
<!--                   class="wk-form-field__input">-->
<!--            <span class="wk-form-field__message">Email is invalid</span>-->
<!--        </div>-->

<!--        <div class="wk-form-field wk-form-field&#45;&#45;invalid">-->
<!--            <label for="password" class="wk-form-field__label">Password</label>-->
<!--            <input type="password"-->
<!--                   id="password"-->
<!--                   name="password"-->
<!--                   class="wk-form-field__input">-->
<!--            <span class="wk-form-field__message">Password is invalid</span>-->
<!--        </div>-->

<!--        <button type="submit" id="submit" class="wk-form-button">Submit</button>-->
<!--    </div>-->

<!--    <script src="https://www.google.com/recaptcha/api.js?render=6LeNZrwbAAAAAKXPTmJj5KMdUwI2GE6XAUbCU6DM"></script>-->
    <script src="wallkit.umd.min.js" defer></script>

    <script src="wallkit-integration-library.js"></script>
<!--    <script src="https://cdn.wallkit.net/js/integration/3.0.1/wallkit-integration-library.min.js"></script>-->

    <script
            src="https://js.sentry-cdn.com/c9f328bbf5ba4793be5a393badc7385f.min.js"
            crossorigin="anonymous"
    ></script>

    <script>
        window.geoip = (data) => {
            console.log('data', data);
        }
    </script>

    <script src="https://get.geojs.io/v1/ip/geo.js"></script>


    <script>
        Sentry.onLoad(function() {
            Sentry.init({
                release: "1.0.0 ",
                environment: "thewrap",
            });
            Sentry.configureScope(scope => {
                scope.setTag('123' );
            });
            // etc.
        });

        try {
            Wallkit.login({email: 'test@test.com', password: 'test'});

            myUndffef();
        } catch (e) {
            Sentry.captureException(e);
        }

        // myUndeffeoo();
    </script>




    <script>
        const modalContent = document.createElement('div');
        modalContent.classList.add('wrap-pro-sign-up');

        modalContent.insertAdjacentHTML('beforeend', `
         <div id="classic-login">
            <div id="authorization-error"></div>
            <h3 class="wrap-pro-sign-up__title">Authorisation</h3>
         </div>
         <div id="user-journey-header" style="display: none">
             <h3 class="wrap-pro-sign-up__title">WrapPRO - 7-Day Free Trial</h3>
             <ul class="wrap-pro-sign-up__steps">
               <li class="wrap-pro-sign-up__step wrap-pro-sign-up__step--active">Account</li>
               <li class="wrap-pro-sign-up__step">Free Trial</li>
               <li class="wrap-pro-sign-up__step">Newsletters</li>
               <li class="wrap-pro-sign-up__step">Confirmation</li>
             </ul>
             <h4 class="wrap-pro-sign-up__small-title">Let's Get Started</h4>
         </div>


         <div id="wk-auth-form"></div>

         <p class="wrap-pro-sign-up__terms">By signing up i agree with the <a href="#" class="green-text">Terms & Conditions</a></p>
        `);

        window.addEventListener('load', () => {
            window.WallkitInt = new WallkitIntegration({
                public_key: 'st3adcd3-9156-44bd-bc89-8092a58c6ae9',
                // public_key: '3535',
                mode: 'dev',
                version: 'v1',
                auth: { // default false
                    // firebase: false,
                    firebase: {
                        config: {
                            apiKey: "AIzaSyCmIluc9x63JOu7I5UMZ8q5M4AbluBeC8o",
                            authDomain: "wallkit-258413.firebaseapp.com",
                            databaseURL: "https://wallkit-258413.firebaseio.com",
                            projectId: "wallkit-258413",
                            storageBucket: "wallkit-258413.appspot.com",
                            messagingSenderId: "767802802956",
                            appId: "1:767802802956:web:e8fc363619c47f7fff7f29",
                            measurementId: "G-ER6R7Z47R3"
                        },
                        providers: [
                            {
                                provider: 'email',
                                buttonColor: '#000',
                                fullLabel: 'Continue with Email',
                                requireDisplayName: false
                            },
                            // {
                            //     provider: 'google'
                            // }
                        ],
                        genuineForm: false,
                        termsOfService: null,
                        tosURL: 'https://wallkit.net/terms',
                        privacyPolicyURL: 'https://wallkit.net/terms',
                        elementSelector: '#wrap-pro-auth'
                    },
                    modal: {
                        title: 'Authorisation',
                        content: modalContent
                    },
                    reCaptcha: false,
                },
                analytics: {
                    parseUTM: true // default true
                },
                onInit: () => {
                    console.log('TEST??');
                    // const post = new WallkitInt.content(postInfo);

                    // console.log('post', post);

                    // grecaptcha.ready(function() {
                    //     grecaptcha.execute('6LeNZrwbAAAAAKXPTmJj5KMdUwI2GE6XAUbCU6DM', {action: 'submit'}).then(function(token) {
                    //         // Add your logic to submit to your backend server here.
                    //     });
                    // });

                    // post.checkAccess().then((response) => {
                    //     console.log('response', response);
                    // }).catch((error) => {
                    //     console.log('ERROR', error);
                    // });
                    //
                    // try {
                    //     console.log('TEST');
                    //     WallkitInt.sdk.methods.login({email: 'test@test.com', password: 'test'}).catch((error) => {
                    //         Sentry.captureException(error);
                    //     });
                    // } catch (e) {
                    //     console.log('e', e);
                    //     Sentry.captureException(e);
                    // }
                }
            });

            function switchLoginContent(type) {
                const journeyHeader = document.getElementById('user-journey-header');
                const classicHeader = document.getElementById('classic-login');

                const authCallback = function () {
                    if (type === 'journey') {
                        WallkitInt.modal('new-user-journey');
                    } else if (type === 'classic') {
                        WallkitInt.modal('plans');
                    }
                };

                WallkitInt.events.unsubscribe('success-auth', authCallback);

                if (type === 'journey') {
                    journeyHeader.style.display = 'block';
                    classicHeader.style.display = 'none';
                } else if (type === 'classic') {
                    journeyHeader.style.display = 'none';
                    classicHeader.style.display = 'block';
                }

                WallkitInt.events.subscribe('success-auth', authCallback, { once: true });
            }

            function openJourneyLogin() {
                switchLoginContent('journey');
                WallkitInt.authentication.show();
            }

            window.openJourneyLogin = openJourneyLogin;

            function openClassicLogin() {
                switchLoginContent('classic');
                WallkitInt.authentication.show();
            }

            console.log('openClassicLogin', openClassicLogin);
            window.openClassicLogin = openClassicLogin;

            console.log('window.openClassicLogin', window.openClassicLogin);

            window.WallkitInt.events.subscribe('firebase-ui-shown', () => {
                window.WallkitInt.authentication.firebase.attachEmailListener((event) => {
                    if (event) {
                        setTimeout(() => {
                            const passwordFieldElement = document.querySelector('.firebaseui-id-password');

                            if (passwordFieldElement) {
                                const email = event.target.value;

                                Wallkit.checkUserFirebaseRelation(email, [WallkitInt.config.public_key])
                                    .then(({ has_firebase_relation }) => {
                                        if (has_firebase_relation) {
                                            setTimeout(() => {
                                                const firebaseUiTitle = document.querySelector('.firebaseui-title');

                                                if (firebaseUiTitle) {
                                                    firebaseUiTitle.innerHTML = `Great! We see youâ€™re a subscriber.<br>Please set up a password to continue.`
                                                }
                                            });
                                        }
                                    })
                                    .catch((error) => {
                                        console.log('error', error);
                                    })
                            }
                        });
                    }
                });
            });
        });



    </script>

<!--    <script src="https://cdn.wallkit.net/js/integration/3.0.2/wallkit-integration-library.min.js"></script>-->

<!--    <script src="https://www.thewrap.com/wp-content/themes/thewrap-canvas/js/wallkit-integration-library.js?ver=1.15.85" onload="window.onLoad()"></script>-->
</body>
</html>
